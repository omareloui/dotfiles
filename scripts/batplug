#!/usr/bin/env bash

is_charging=$1
current_percentage=$(acpi | grep -Po '[0-9]{1,3}(?=%)')

NOTIFICATION_ID=0

if [[ -f /tmp/battery_notification_id ]]; then
	NOTIFICATION_ID=$(cat /tmp/battery_notification_id)
fi

if ((is_charging == 1)); then
	NOTIFICATION_ID=$(notify-send \
		"Charging" \
		"$current_percentage% of battery charged." \
		-i "$HOME/.local/share/icons/battery-charging.png" \
		-u low \
		-r "$NOTIFICATION_ID" \
		-p)
	paplay "/usr/share/sounds/Yaru/stereo/power-plug.oga"
elif ((is_charging == 0)); then
	NOTIFICATION_ID=$(
		notify-send \
			"Disconnected" \
			"$current_percentage% of battery remaining." \
			-i "$HOME/.local/share/icons/battery.png" \
			-u low \
			-r "$NOTIFICATION_ID" -p
	)
	paplay "/usr/share/sounds/Yaru/stereo/power-unplug.oga"
fi

echo "$NOTIFICATION_ID" >/tmp/battery_notification_id
